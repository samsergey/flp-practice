<!DOCTYPE html>
<html lang="ru">
  <title></title>
  <head>
    <meta charset = "UTF-8"/>
    <link rel="stylesheet" href="../css/TPLBook.css">
    <link rel="stylesheet" href="../css/idea.css">
    <link rel="stylesheet" href="../lib/katex/katex.min.css">    

    <script src="../lib/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="../lib/katex/katex.min.js"></script>
    <style>
      .logo {
      display: inline-block;
      float: left;
      margin: 0 1em 1em 0;
      }
    </style>
  </head>
  <body>
    <p id="header"></p>
    <div class='tasks'>
      <!-- ------------------------------------------------------------ -->

      <h2>Чтение данных в формате CSV</h2>
    
      <p><img  class='logo' src='img/csv.png' width=15%/>Хранение данных в виде текстовых таблиц удобно как для человека, так и для машины. Среди табулированных данных часто встречается формат значений, разделяемых запятыми — CSV (Comma Separated Values), он используется такими программами как <sl>MS Excell</sl>, почтовыми клиентами для хранения адресов и т.п.</p>

      <p>
	Упрощённая спецификация формата:
	<ul>
	  <li> Каждая строка файла — это одна строка таблицы.
	  <li> Разделителем значений колонок является символ запятой (<tt>,</tt>). Однако на практике часто используются другие разделители, например в русифицированном <sl>MS Excell</sl> используется символ "точка с запятой" (<tt>;</tt>)
	  <li> Значения, содержащие строки, обрамляются двойными кавычками (<tt>&quot;</tt>).
	</ul>
      </p>
  
<p>
  Приведём пример простой "базы данных", хранящей информацию о некотрых персонах:

  <pre>"James Mitchell", 32, "golf, beer",     yes
"Garry Potter",   14, "magic"
"Mary Kay",       25, "James Mitchell", no
"Goofy",          85, "troubles",       yes</pre>

	Эти данные будут соответствовать списку записей данных типа <code>Person</code>:

	<pre><hs>data Person { name :: String
            , age :: Int
            , hobby :: String
	    , married :: Maybe Bool } deriving Show</hs></pre>
	Обратите внимание на то, что последнего поля в таблице может и не быть.</p>
      
      <p>Транслятор отражает структуру типа данных. Типу-произведению соответствует аппликативная последовательность:
      <pre><hs>person = Person <$> string_
                <*> number_
                <*> string_
		<*> optional bool_</hs></pre>
      </p>

      <task>Определите трансляторы для элементов:
	<pre><hs>number_ = _
string_ = _
bool_ = _</hs></pre>
      </task>

      <task>Напишите функцию <code>parse</code>, которая возвращает только результат (в случае успешной трансляции).<pre><hs>parse :: Parser String a -> String -> Maybe a</hs></pre></task>
      
      <task>Напишите функцию <code>clean</code>, которая убирала бы в таблицк лишние пробелы и знаки табуляции  (оставляя их в строковых полях).
	<pre><ghci><l></l> cleanJSON "'James Mitchell', 32, 'golf'"
<o>Just "'James Mitchell',32,'golf'"</o></hs></pre></task>

      <task>Напишите функцию <code>readCSV</code> которая читает строку, содержащую СSV-таблицу, возвращая список объектов, считываемых указанным транслятором.<pre><hs>readCSV :: Parser String a -> String -> [a]</hs></pre></task>

      <h2>Чтение данных в формате JSON</h2>

      <p><img  class='logo' src='img/json.jpg' width=20%/>Продолжим разбор стандартных форм хранения данных. Рассмотрим ещё один крайне популярный формат JSON. Этот формат широко используется для сериализации и передачи в виде потока, сложных иерархических структур: произвольных объектов, массивов и элементарных данных.</p>

      <p> Вот, что написано на официальном сайте <tt>http://www.json.org/json-ru.html</tt>
	<disclaim>JSON (JavaScript Object Notation) - простой формат обмена данными, удобный для чтения и написания как человеком, так и компьютером. Он включает в себя следующие структуры:

	  <ul>
	    <li/><em>Объект</em> — неупорядоченный набор пар ключ/значение. Объект начинается с открывающей фигурной скобки и заканчивается закрывающей фигурной скобкой. Каждое имя сопровождается двоеточием, пары ключ/значение разделяются запятой.

	    <pre><tt>{'name':'Jane','age':22}</tt></pre>
      
	    <li/><em>Массив</em> — упорядоченная коллекция значений. Массив начинается с открывающей квадратной скобки и заканчивается закрывающей квадратной скобкой. Значения разделены запятой.

	    <pre><tt>[23,45,6,23]
['cat','dog']</tt></pre>
      
	    <li/><em>Значение</em> может быть строкой в кавычках, числом, <tt>true</tt>, <tt>false</tt>, объектом или массивом. Эти структуры могут быть вложенными.

	    <li/> Пробелы могут использоваться между любыми лексемами.
	  </ul>
	</disclaim>
      </p>

      <p>Приведём пример выражения JSON (мы пользуемся стандартом JSON5, допускающим одинарные кавычки):</p>

      <pre><tt>{
    'workers' :
    [
	{
	    'name' : 'James Mitchell',
	    'age'  : 32,
	    'hobby': ['golf', 'eating pizza']
	},
	{
	    'name' : 'Mary Kay',
	    'hobby': ['James Mitchell']
	},
	{
	    'name': 'Garry Potter',
	    'age' : 14
	}    
    ]
}</tt></pre>

      <p>Чтение JSON означает интерпретацию строки и создание соответствующей структуры данных.</p>

      <p>Для представления данных определим тип <code>JSON</code>:
	<pre><hs>data JSON = N Int
          | S String
          | B Bool
          | A [JSON]
          | O [(String, JSON)]
          deriving Show</hs></pre></p>
      
      <p>
	Транслятор отражает структуру типа:

      <pre><hs>json = N <$> number_ <|>
       S <$> string_ <|>
       B <$> bool_ <|>
       A <$> listOf json `between` "[]" <|>
       O <$> listOf (pairOf string_ json) `between` "{}"</hs></pre>
      </p>

      <task>Определите трансляторы для элементов:

	<pre><hs>listOf p = _
pairOf p1 p2 = _
between p [s1,s2] = _</hs></pre>
      </task>

 <task> Напишите функцию <code>readJSON</code>:
   <pre><hs>readJSON :: String -> Maybe JSON</hs></pre> и прочтите с её помощью выражение, приведённое выше.</task>

      <!-- ------------------------------------------------------------ -->
    </div>
    <p id="footer"></p>
    <script src="../lib/postprocessing.js"></script>
  </body>
</html>
