<!DOCTYPE html>
<html lang="ru">
  <title></title>
  <head>
    <meta charset = "UTF-8"/>
    <link rel="stylesheet" href="../css/TPLBook.css">
    <link rel="stylesheet" href="../css/obsidian.css">
    <link rel="stylesheet" href="../lib/katex/katex.min.css">    

    <script src="../lib/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="../lib/katex/katex.min.js"></script>
  </head>
  <body>
    <p id="header"></p>

    <div class='tasks'>
      
      <p>Вооружившись знаниями о функторах и моноидах построим гибкую и расширяемую систему для вывода графической информации в формате SVG (Scalable Vector Graphics).</p>

      <h4>Типы для графических примитивов</h4>
      <p>Определим типы для представления двух (для начала) графических примитивов: точек и ломаных линий</p>
      <pre><hs>type Pt = (Float, Float)

data Primitive = Point Pt
               | Line [Pt]
  deriving Show</hs></pre>

      <h4>Представление примитивов в формате SVG</h4>

      <p>В формате SVG наши примитивы представляются в виде строк:<ul>
	  <li> точка с координатами <eq>(x, y)</eq> <pre>"&lt;circle rx='x' ry='y' r='1'/&gt;"</pre>
	  <li> ломаная линия с координатами <eq>(x_1, y_1), (x_2, y_2),...</eq> <pre>"&lt;polyline points='x1,y1 x2,y2 ...'/&gt;"</pre>
	</ul>
      </p>

      <task>Для того, чтобы упростить генерацию SVG напишите функцию <code>format</code> для форматирования строк по шаблону, последовательно заменяя символ <tt>'_'</tt> строками из списка. Например:
	<pre><ghci> Main> format "_ said: '_!'" ["John", "Hello"]
"John said: 'Hello!'"</ghci></pre>
	<em>Подсказка: воспользуйтесь функцией <code>splitOn</code> из модуля <code>Data.List.Split</code> для того, чтобы разбить форматируемую строку на части, а потом с помощью функции <code>zipWith</code> перемешайте эти части со строками из списка.</em>
      </task>

      <p>Определим собственный класс для того, что может быть экспортировано в SVG:
	<pre><hs>class SVG a where
    toSVG :: a -> String</hs></pre></p>

      <task>Определите экземпляр этого класса для типа <code>Primitive</code>:
	<pre><hs>instance SVG Primitive where
  toSVG (Point (x,y)) = _
  toSVG (Line pts) = _</hs></pre>
      </task>

      
      <p>Сами примитивы ещё не образуют полноценного изображения. Для того, чтобы можно было увидеть картинку, нужно объединить примитивы в такую структуру:
	<pre>"&lt;svg width='_' height='_' fill='none' stroke='black'&gt;
  примитив
  примитив
  ...
&lt;/svg&gt;"</pre>
	Здесь аттрибуты <tt>width</tt> и <tt>height</tt> задают размеры изображения. Сохранив этот текст в файл с расширением <tt>.html</tt> можно будет увидеть изображение в веб-браузере.</p>

      <p>
	Для представления картинки определим новый тип <code>Picture</code>:
	<pre><hs>data Picture = Picture BoundingBox [Primitive]
   deriving Show

type BoundingBox = ( Min Float, Max Float
                   , Min Float, Max Float )</hs></pre>
	Здесь <code>BoundingBox</code> хранит координаты "рамки", обрамляющей изображения.
      </p>

      <task>Определите экземпляр класса <code>SVG</code> для типа <code>Picture</code> и два конструктора <code>line :: [Pt] -> Picture</code> и <code>point :: Pt -> Picture</code>, которые бы вычисляли обрамляющие координаты для примитивов.
	<p><em>Подсказка: определите минимальное и максимальное допустимое значение координат, соответственно, 0 и 1000 используя экземпляр класса <code>Bounded</code> для типа <code>Float</code>.</em>
	</p>
      </task>

      <task>Изобразите с помощью констрктора <code>line</code> конструктор для правильных многоугольников. Запишите SVG-выражение в файл <tt>test.html</tt> с помощью функции <code>writeFile</code> и откройте изображение в браузере.</task>

      <task>Добавьте в тип <code>Primitive</code> конструктор окружности, принимающий координаты центра и радиус. Определите для него функцию <code>toSVG</code>.</task>
      
      <h3>Композиция изображений</h3>
      <task>Так как в формате SVG примитивы попросту перечисляются, а затем изображаются, накладываясь друг на друга, это наводит на мысль, что изображения образуют моноид с операцией наложения. Определите экземпляр класса <code>Monoid</code> для типа <code>Picture</code>. Создайте избражение, как на рисунке:
	<p><svg width='185.0' height='185.0' fill='none' stroke='blue'><circle cx='100.0' cy='100.0' r='80.0'/><circle fill='blue' cx='100.0' cy='100.0' r='1'/><polyline points=' 180.0,100.0 124.72136,176.08453 35.278633,147.02281 35.27864,52.977173 124.721375,23.915482 180.0,100.000015'/></svg></p></task>
      
      <h3>Преобразования изображений</h3>
      
    </div>

    <p id="footer"></p>
    <script src="../lib/postprocessing.js"></script>
  </body>
</html>

